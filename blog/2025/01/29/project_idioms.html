<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8" >
  <meta name="generator" content="antenna/0.0.13" >
  <meta name="date" content="2025-10-14T15:56:52-07:00" >
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
  <meta name="language" content="EN" >
  <title>R. S. Doiel, Software Engineer/Analyst &mdash; Robert's ramblings</title>
  <link rel="altenate" type="text/markdown" title="R. S. Doiel, Software Engineer/Analyst &mdash; Robert's ramblings" href="project_idioms.md" >
  <link rel="stylesheet" type="text/css" href="/css/site.css" >
  <link rel="alternate" title="Recent Blog Post" type="application/rss+xml" href="index.xml" >
  <link href="archive.xml" rel="alternate" title="Archive of Blog Posts" type="application/rss+xml" >
  <link rel="alternate" title="Markdown source for page" type="application/markdown" href="index.md" >
  <link href="osd.xml" rel="search" type="application/opensearchdescription+xml" title="Robert's Rambling Search Engine" >
  <script type="module" src="/modules/copyToClipboard.js" ></script>
</head>
<body>
  <nav>
    <ul>
    <li><a href="/" title="R. S. Doiel"><img class="blog-logo" src="/media/Wee-Free-Doiels-Summer-Reading.svg" alt="Wee Free Doiels, Summer Reading"></a></li>
    <li><a href="/">R. S. Doiel</a></li>
    <li><a href="/about.html">About</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/presentations.html">Presentations</a></li>
    <li><a href="/series/">Series</a></li>
    <li><a href="/search.html">Search</a></li>
    <li><a href="https://github.com/rsdoiel">GitHub</a></li>
    <li><a href="/rss.xml" title="RSS Feed">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9"></path>
    <path d="M4 4a16 16 0 0 1 16 16"></path>
    <circle cx="5" cy="19" r="1"></circle> </svg> RSS </a></li>
    </ul>
  </nav>

  <section>
    <article data-published="2025-01-29" data-link="https://rsdoiel.github.io/blog/2025/01/29/project_idioms.html">
      <h1>Deno 2.1.7, Project Idioms</h1>
      <p>I've noticed a collection of file and code idioms I've been used in my recent Deno+TypeScript projects at work. I've captured them here as a future reference.</p>
      <h2>Project files</h2>
      <p>My project generally have the following files, these are derived from the <a href="https://codemeta.github.io">CodeMeta</a> file using <a href="https://caltechlibrary.github.io/CMTools">CMTools</a>.</p>
      <dl>
      <dt>codemeta.json</dt>
      <dd>Primary source of project metadata, used to generate various files</dd>
      <dt>CITATION.cff</dt>
      <dd>used by GitHub for citations. version, dateModified, datePublished and releaseNotes</dd>
      <dt>about.md</dt>
      <dd>A project about page. This is generated based on the codemeta.json file.</dd>
      <dt>README.md, README</dt>
      <dd>A general read me describing the project and pointing to INSTALL.md, user_manual.md as appropriate</dd>
      <dt>INSTALL.md</dt>
      <dd>These are boiler plate description of how to install and compile the software</dd>
      <dt>user_manual.md</dt>
      <dd>This is an index document, a table of contents. It points to other document including Markdown versions of the man page(s).</dd>
      </dl>
      <p>For TypeScript projects I also include a following</p>
      <dl>
      <dt>version.ts</dt>
      <dd>This hold project version information used in the TypeScript co-debase. It is generated from the codemeta.json via CMTools.</dd>
      <dt>helptext.ts</dt>
      <dd>This is where I place a function, <code>fmtHelp()</code>, for rendering response to the &quot;help&quot; command line option.</dd>
      </dl>
      <p>I'm currently ambivalent about &quot;main.ts&quot; file which is created by <code>deno init</code>. My ambivalent is that most of my projects wind up producing more than one program from a shared code base. a single &quot;main.ts&quot; doesn't really fit that situation.</p>
      <p>The command line tool will have a TypeScript with it's name. Inside this file I'll have a main function and use the Deno idiom <code>if (import.meta.main) main();</code> to invoke it. I don't generally put the command line  TypeScript in my &quot;mod.ts&quot; file since it's not going to work in a browser or be useful outside my specific project.</p>
      <dl>
      <dt>mod.ts</dt>
      <dd>I usually re-export modules here that maybe useful outside my project (or in the web browser).</dd>
      <dt>deps.ts</dt>
      <dd>I use this if there are allot of files consistently being imported across the project, otherwise I skip it.</dd>
      </dl>
      <h2>What I put in Main</h2>
      <p>I use the main function to define command line options, handle parameters such as data input, output and errors. It usually invokes a primary function modeled in the rest of the project code.</p>
      <p>Here is an example Main for a simple &quot;cat&quot; like program.</p>
      <pre><code class="language-TypeScript">import { parseArgs } from &quot;jsr:@std/cli&quot;;
      import { licenseText, releaseDate, releaseHash, version } from &quot;./version.ts&quot;;
      import { fmtHelp, helpText } from &quot;./helptext.ts&quot;;
      
      const appName = &quot;mycat&quot;;
      
      async function main() {
        const app = parseArgs(Deno.args, {
          alias: {
            help: &quot;h&quot;,
            license: &quot;l&quot;,
            version: &quot;v&quot;,
          },
          default: {
            help: false,
            version: false,
            license: false,
          },
        });
        const args = app._;
      
        if (app.help) {
          console.log(fmtHelp(helpText, appName, version, releaseDate, releaseHash));
          Deno.exit(0);
        }
        if (app.license) {
          console.log(licenseText);
          Deno.exit(0);
        }
        if (app.version) {
          console.log(`${appName} ${version} ${releaseHash}`);
          Deno.exit(0);
        }
      
        let input: Deno.FsFile | any = Deno.stdin;
      
        // handle case of many file names
        if (args.length &gt; 1) {
          for (const arg of args) {
            input = await Deno.open(`${arg}`);
            for await (const chunk of input.readable) {
              const decoder = new TextDecoder();
              console.log(decoder.decode(chunk));
            }
          }
          Deno.exit(0);
        }
        if (args.length &gt; 0) {
          input = await Deno.open(Deno.args[0]);
        }
        for await (const chunk of input.readable) {
          const decoder = new TextDecoder();
          console.log(decoder.decode(chunk));
        }
      }
      
      if (import.meta.main) main();
      </code></pre>
      <h2>helptext.ts</h2>
      <p>The following is an example of the <a href="helptext.ts">helptext.ts</a> file for the demo <a href="mycat.ts">mycat.ts</a>.</p>
      <pre><code class="language-TypeScript">export function fmtHelp(
        txt: string,
        appName: string,
        version: string,
        releaseDate: string,
        releaseHash: string,
      ): string {
        return txt.replaceAll(&quot;{app_name}&quot;, appName).replaceAll(&quot;{version}&quot;, version)
          .replaceAll(&quot;{release_date}&quot;, releaseDate).replaceAll(
            &quot;{release_hash}&quot;,
            releaseHash,
          );
      }
      
      export const helpText =
        `%{app_name}(1) user manual | version {version} {release_hash}
      % R. S. Doiel
      % {release_date}
      
      # NAME
      
      {app_name}
      
      # SYNOPSIS
      
      {app_name} FILE [FILE ...] [OPTIONS]
      
      # DESCRIPTION
      
      {app_name} implements a &quot;cat&quot; like program.
      
      # OPTIONS
      
      Options come as the last parameter(s) on the command line.
      
      -h, --help
      : display help
      
      -v, --version
      : display version
      
      -l, --license
      : display license
      
      
      # EXAMPLES
      ~~~shell
      {app_name} README.md
      {app_name} README.md INSTALL.md
      ~~~
      `;
      </code></pre>
      <h2>Generating version.ts</h2>
      <p>The <a href="version.ts">version.ts</a> is generated form two files, [codemeta.json] and [LICENSE] using the CMTools, <code>cmt</code> command.</p>
      <pre><code>cmt codemeta.json veresion.ts
      </code></pre>
      
    </article>
  </section>
  <footer>
    <footer>
    <p>copyright Â© 2016 - 2025 R. S. Doiel<br /> <a
    href="/rssfeed.html">RSS</a> feeds and website built with <a
    href="https://rsdoiel.github.io/antennaApp">antennaApp</a>.
    </footer>
    <script type="module">
      await import('/pagefind/pagefind-highlight.js');
      new PagefindHighlight({ highlightParam: "highlight" });
    </script>
  </footer>
</body>
</html>
