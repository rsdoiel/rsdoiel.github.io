<!doctype html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <link  rel="alternate" type="text/markdown" href="generating_rss_with_flatlake.md" title=""/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/site.css" />
  <meta name="generator" content="antenna/0.0.6">
  <meta name="date" content="2025-09-15T14:18:45-07:00">
</head>
<body>
  <header>
    (date: 2025-09-15 14:18:45)
  </header>
  <nav>
    <ul>
    <li><a href="/" title="R. S. Doiel"><img class="blog-logo" src="/media/Wee-Free-Doiels-Summer-Reading.svg" alt="Wee Free Doiels, Summer Reading"></a></li>
    <li><a href="/">R. S. Doiel</a></li>
    <li><a href="/about.html">About</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/presentations.html">Presentations</a></li>
    <li><a href="/series/">Series</a></li>
    <li><a href="/search.html">Search</a></li>
    <li><a href="https://github.com/rsdoiel">GitHub</a></li>
    <li><a href="/index.xml" title="RSS, recent posts">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9"></path>
    <path d="M4 4a16 16 0 0 1 16 16"></path>
    <circle cx="5" cy="19" r="1"></circle> </svg> RSS </a></li>
    </ul>
  </nav>

  <section>
    <article data-published="2025-08-10" data-link="https://rsdoiel.github.io/blog/2025/08/10/generating_rss_with_flatlake.html">
      <h1 id="generating-rss-with-flatlake">Generating RSS with FlatLake</h1>
      <p>By R. S. Doiel, 2025-08-10</p>
      <p>One of the must have features missing from many static websites are RSS feeds.<br />
      Many people produce blogs using CommonMark/Markdown documents with front matter.<br />
      <a href="https://flatlake.app" title="an open source tool from Cloud Cannon">FlatLake</a><br />
      produces a JSON API from front matter. The API makes it easy to generate various<br />
      types of feeds. All that is needed is something to translate the JSON API<br />
      documents to the feed format you want. In this post I will show a proof of<br />
      concept using Deno+TypeScript to process the Flatlake generate JSON API into an<br />
      RSS feed.</p>
      <h2 id="requirements-for-your-site">Requirements for your site</h2>
      <p>You need <a href="https://flatlake.app">FlateLake</a> installed. You also need to have<br />
      front matter in your CommonMark/Markdown documents. No front matter, no API. I<br />
      rely on front matter in my publication process for blog so FlatLake is a good<br />
      fit. I only use a mimum of features in FlatLake. Here's the configuration file I<br />
      use.</p>
      <pre><code class="language-yaml">global:
        outputs:
          - &quot;list&quot;
      collections:
        - output_key: &quot;posts&quot;
          page_size: 24
          sort_key: &quot;datePublished&quot;
          sort_direction: &quot;desc&quot;
          list_elements:
            - &quot;data&quot;
            - &quot;content&quot;
          inputs:
            - path: &quot;./blog&quot;
              glob: &quot;**/*{md}&quot;
      </code></pre>
      <h2 id="generating-the-json-api">Generating the json api</h2>
      <p>Once you have FlatLake configured generating the JSON API is as simple as<br />
      running the command</p>
      <pre><code class="language-shell">flatlake
      </code></pre>
      <p>That's it. It scans the directory named &quot;blog&quot; in the directory where I stage my<br />
      website. The output goes to a directory called &quot;api&quot;. If you prefer a diffent<br />
      path FlatLake has options to support that. See <code>flatlake --help</code> or the website<br />
      <a href="https://flatlake.app/docs">FlatLake/docs</a>. The verbose and logging options are<br />
      helpful in understanding what FlatLake is doing.</p>
      <h2 id="short-anatomy-of-rss-xml">Short anatomy of RSS XML</h2>
      <p>The RSS XML has two parts. A channel description and the items in the feed. The<br />
      items map the data about your blog posts. The channel description isn't directly<br />
      available from the FlatLake generated data. The easy solution I've chosen is to<br />
      describe the channel in a YAML. Here's the example I use for my blog.</p>
      <pre><code class="language-yaml">title: &quot;Robert's Ramblings&quot;
      description: &quot;Robert's website and blog posts&quot;
      link: &quot;https://rsdoiel.github.io&quot;
      </code></pre>
      <h2 id="json-api-to-rss">JSON API to RSS</h2>
      <p>In my publication process the next thing I do is used a Deno+TypeScript program<br />
      to convert the JSON API into an RSS feed. I have one feed for my site contains<br />
      recent posts. The path in the api tree I use it <code>api/posts/all/page-1.json</code>.<br />
      Based on my configuration file this contains the most recent 24 posts sorted by<br />
      descending publication date. At this point it's just a matter of cross walking<br />
      the content of &quot;page-1.json&quot; into an RSS XML feed file.</p>
      <p>Here's a TypeScript module I knock together to test out the concept.</p>
      <pre><code class="language-TypeScript">/**
       * flatlakeToRSS2.ts translate a FlatLake JSON API document to RSS2 XML.
       *  
       *  Copyright (C) 2025  R. S. Doiel
       * 
       *  This program is free software: you can redistribute it and/or modify
       *  it under the terms of the GNU Affero General Public License as
       *  published by the Free Software Foundation, either version 3 of the
       *  License, or (at your option) any later version.
       *
       *  This program is distributed in the hope that it will be useful,
       *  but WITHOUT ANY WARRANTY; without even the implied warranty of
       *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
       *  GNU Affero General Public License for more details.
       *
       *  You should have received a copy of the GNU Affero General Public License
       *  along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.
       */
      // Define the structure of your input data
      export interface Post {
        content: string;
        data: {
          abstract: string;
          author: string;
          dateCreated?: string;
          dateModified?: string;
          datePublished?: string;
          keywords: string[];
          pubDate?: string;
          title: string;
          url: string;
        };
      }
      
      // Define the structure of the RSS feed
      export interface RSSFeed {
        title: string;
        description: string;
        link: string;
        language?: string;
        copyright?: string;
        managingEditor?: string;
        webMaster?: string;
        items: RSSItem[];
      }
      
      export interface RSSItem {
        title: string;
        description: string;
        link: string;
        pubDate: string;
        author: string;
        categories: string[];
      }
      
      // Function to convert JSON data to RSS feed with YAML configuration
      export function convertToRSS(
        posts: Post[],
        channelInfo: Partial&lt;RSSFeed&gt;,
      ): RSSFeed {
        const feed: RSSFeed = {
          title: channelInfo.title || &quot;My Blog&quot;,
          description: channelInfo.description || &quot;A collection of blog posts&quot;,
          link: channelInfo.link || &quot;http://example.com&quot;,
          language: channelInfo.language,
          copyright: channelInfo.copyright,
          managingEditor: channelInfo.managingEditor,
          webMaster: channelInfo.webMaster,
          items: [],
        };
      
        posts.forEach((post) =&gt; {
          const item: RSSItem = {
            title: post.data.title,
            description: post.data.abstract,
            link: `http://example.com/${post.data.url}`,
            pubDate: new Date(
              post.data.datePublished || post.data.pubDate || post.data.dateCreated ||
                post.data.dateModified || Date.now(),
            ).toUTCString(),
            author: post.data.author,
            categories: post.data.keywords,
          };
          feed.items.push(item);
        });
      
        return feed;
      }
      
      // Function to generate the RSS XML
      export function generateRSS(feed: RSSFeed): string {
        const itemsXML = feed.items
          .map(
            (item) =&gt; `
              &lt;item&gt;
                  &lt;title&gt;&lt;![CDATA[${item.title}]]&gt;&lt;/title&gt;
                  &lt;description&gt;&lt;![CDATA[${item.description}]]&gt;&lt;/description&gt;
                  &lt;link&gt;${item.link}&lt;/link&gt;
                  &lt;pubDate&gt;${item.pubDate}&lt;/pubDate&gt;
                  &lt;author&gt;${item.author}&lt;/author&gt;
                  ${
              item.categories.map((category) =&gt; `&lt;category&gt;${category}&lt;/category&gt;`)
                .join(&quot;&quot;)
            }
              &lt;/item&gt;
          `,
          )
          .join(&quot;&quot;);
      
        return `&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
      &lt;rss version=&quot;2.0&quot;&gt;
          &lt;channel&gt;
              &lt;title&gt;&lt;![CDATA[${feed.title}]]&gt;&lt;/title&gt;
              &lt;description&gt;&lt;![CDATA[${feed.description}]]&gt;&lt;/description&gt;
              &lt;link&gt;${feed.link}&lt;/link&gt;
              ${feed.language ? `&lt;language&gt;${feed.language}&lt;/language&gt;` : &quot;&quot;}
              ${feed.copyright ? `&lt;copyright&gt;${feed.copyright}&lt;/copyright&gt;` : &quot;&quot;}
              ${
          feed.managingEditor
            ? `&lt;managingEditor&gt;${feed.managingEditor}&lt;/managingEditor&gt;`
            : &quot;&quot;
        }
              ${feed.webMaster ? `&lt;webMaster&gt;${feed.webMaster}&lt;/webMaster&gt;` : &quot;&quot;}
              ${itemsXML}
          &lt;/channel&gt;
      &lt;/rss&gt;`;
      }
      </code></pre>
      <h2 id="putting-it-all-together">Putting it all together</h2>
      <p>The demo program can be compiled with the follow.</p>
      <pre><code class="language-shell">git clone https://github.com/rsdoiel/flatlakeToRSS2
      cd flatlakeToRSS2
      deno task build
      </code></pre>
      <p>The program in the <code>bin</code> directory can then be used to generate the RSS XML from<br />
      your FlatLake API. Copy it to some place in your PATH.</p>
      <p>Now I go to my website staging directory. I can take the following steps to test<br />
      RSS generation from FlatLake.</p>
      <pre><code class="language-shell">cd $HOME/Sites/rsdoiel.github.io
      flatlake
      edit rss_channel.yaml # Create the YAML file above
      flatlakeToRSS2 rss_channel.yaml api/posts/all/page-1.json &gt;rss.xml
      </code></pre>
      <h2 id="lessons-learned">Lessons learned</h2>
      <p>There are some very good feed libraries out there like<br />
      <a href="https://scripting.com">Dave Winer's</a><br />
      <a href="https://github.com/scripting/reallysimple">ReallySimple</a>. That could save using<br />
      format strings to render XML. It also has the advantage that is can be use to<br />
      read feeds as well.</p>
      <p>Ideally I'd like the generation of RSS feeds to be in integrated into my<br />
      <a href="/BlogIt">BlogIt</a> tool I am working on.</p>
      <p>This experiment showed that inspite of the limitted documentation of the<br />
      FlatLake website that it's worth exploring as an off the shelf open source<br />
      solution. It might just earn a place along side <a href="https://pagefind.app">PageFind</a><br />
      and <a href="https://pandoc.org">Pandoc</a> as part of my regular web toolkit.</p>
      
    </article>
  </section>
  <footer>
    <p>copyright © 2016 - 2025 R. S. Doiel<br /> <a
    href="/rssfeed.html">RSS</a> feeds and website built with <a
    href="https://rsdoiel.github.io/antennaApp">antennaApp</a>, Bash, Make and <a
    href="https://pandoc.org">Pandoc</a>.</p>
  </footer>

    <script type="module" src="/modules/copyToClipboard.js"></script>
    <script type="module">
      await import('/pagefind/pagefind-highlight.js');
      new PagefindHighlight({ highlightParam: "highlight" });
    </script>
</body>
</html>
