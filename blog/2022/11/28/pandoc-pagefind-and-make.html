<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8" >
  <meta name="generator" content="antenna/0.0.15" >
  <meta name="date" content="2025-10-14T22:54:35-07:00" >
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
  <meta name="language" content="EN" >
  <title>R. S. Doiel, Software Engineer/Analyst &mdash; Robert's ramblings</title>
  <link rel="altenate" type="text/markdown" title="R. S. Doiel, Software Engineer/Analyst &mdash; Robert's ramblings" href="pandoc-pagefind-and-make.md" >
  <link rel="stylesheet" type="text/css" href="/css/site.css" >
  <link rel="alternate" title="Recent Blog Post" type="application/rss+xml" href="index.xml" >
  <link title="Archive of Blog Posts" type="application/rss+xml" href="archive.xml" rel="alternate" >
  <link href="index.md" rel="alternate" title="Markdown source for page" type="application/markdown" >
  <link rel="search" type="application/opensearchdescription+xml" title="Robert's Rambling Search Engine" href="osd.xml" >
  <script type="module" src="/modules/copyToClipboard.js" ></script>
</head>
<body>
  <nav>
    <ul>
    <li><a href="/" title="R. S. Doiel"><img class="blog-logo" src="/media/Wee-Free-Doiels-Summer-Reading.svg" alt="Wee Free Doiels, Summer Reading"></a></li>
    <li><a href="/">R. S. Doiel</a></li>
    <li><a href="/about.html">About</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/presentations.html">Presentations</a></li>
    <li><a href="/series/">Series</a></li>
    <li><a href="/search.html">Search</a></li>
    <li><a href="https://github.com/rsdoiel">GitHub</a></li>
    <li><a href="/rss.xml" title="RSS Feed">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9"></path>
    <path d="M4 4a16 16 0 0 1 16 16"></path>
    <circle cx="5" cy="19" r="1"></circle> </svg> RSS </a></li>
    </ul>
  </nav>

  <section>
    <article data-published="2022-11-28" data-link="https://rsdoiel.github.io/blog/2022/11/28/pandoc-pagefind-and-make.html">
      <h1>Pandoc, Pagefind and Make</h1>
      <p>Recently I've refresh my approach to website generation using three programs.</p>
      <ul>
      <li><a href="https://pandoc.org">Pandoc</a></li>
      <li><a href="https://pagefind.app">Pagefind</a> for providing a full text search of documentation</li>
      <li><a href="https://www.gnu.org/software/make/">GNU Make</a>
      <ul>
      <li><a href="website.mak">website.mak</a> Makefile</li>
      </ul>
      </li>
      </ul>
      <p>Pandoc does the heavy lifting. It renders all the HTML pages, CITATION.cff (from the projects <a href="codemeta.github.io" title="codemeta.json is a metadata documentation schema for documenting software projects">codemeta.json</a>) and rendering an about.md file (also from the project's codemeta.json). This is done with three Pandoc templates. Pandoc can also be used to rendering man pages following a simple page recipe.</p>
      <p>I've recently adopted Pagefind for indexing the HTML for the project's website and providing the full text search UI suitable for a static website. The Pagefind indexes can be combined with your group or organization's static website providing a rich cross project search (exercise left for another post).</p>
      <p>Finally I orchestrate the site construction with GNU Make. I do this with a simple dedicated Makefile called <a href="#website.mak">website.mak</a>.</p>
      <h2>website.mak</h2>
      <p>The website.mak file is relatively simple.</p>
      <pre><code class="language-makefile">#
      # Makefile for running pandoc on all Markdown docs ending in .md
      #
      PROJECT = PROJECT_NAME_GOES_HERE
      
      MD_PAGES = $(shell ls -1 *.md) about.md
      
      HTML_PAGES = $(shell ls -1 *.md | sed -E 's/.md/.html/g') about.md
      
      build: $(HTML_PAGES) $(MD_PAGES) pagefind
      
      about.md: .FORCE
              cat codemeta.json | sed -E 's/&quot;@context&quot;/&quot;at__context&quot;/g;s/&quot;@type&quot;/&quot;at__type&quot;/g;s/&quot;@id&quot;/&quot;at__id&quot;/g' &gt;_codemeta.json
              if [ -f $(PANDOC) ]; then echo &quot;&quot; | pandoc --metadata title=&quot;About $(PROJECT)&quot; --metadata-file=_codemeta.json --template codemeta-md.tmpl &gt;about.md; fi
              if [ -f _codemeta.json ]; then rm _codemeta.json; fi
      
      $(HTML_PAGES): $(MD_PAGES) .FORCE
      	pandoc -s --to html5 $(basename $@).md -o $(basename $@).html \
      		--metadata title=&quot;$(PROJECT) - $@&quot; \
      	    --lua-filter=links-to-html.lua \
      	    --template=page.tmpl
      	git add $(basename $@).html
      
      pagefind: .FORCE
      	pagefind --verbose --exclude-selectors=&quot;nav,header,footer&quot; --bundle-dir ./pagefind --source .
      	git add pagefind
      
      clean:
      	@if [ -f index.html ]; then rm *.html; fi
      	@if [ -f README.html ]; then rm *.html; fi
      
      .FORCE:
      </code></pre>
      <p>Only the &quot;PROJECT&quot; value needs to be set. Typically this is just the name of the repository's base directory.</p>
      <h2>Pandoc, filters and templates</h2>
      <p>When write my Markdown documents I link to Markdown files instead of the HTML versions. This serves two purposes. First GitHub can use this linking directory and second if you decide to repurposed the website as a Gopher or Gemini resource
      you don't linking to the Markdown file makes more sense.  To convert the &quot;.md&quot; names to &quot;.html&quot; when I render the HTML I use a simple Lua filter called <a href="https://stackoverflow.com/questions/40993488/convert-markdown-links-to-html-with-pandoc#49396058" title="see the stackoverflow answer that shows this technique">links-to-html.lua</a>.</p>
      <pre><code class="language-lua"># links-to-html.lua
      function Link(el)
        el.target = string.gsub(el.target, &quot;%.md&quot;, &quot;.html&quot;)
        return el
      end
      </code></pre>
      <p>The &quot;page.tmpl&quot; file provides a nice wrapper to the Markdown rendered as HTML by Pandoc. It includes the site navigation and project copyright information in the wrapping HTML. It is based on the default Pandoc page template with some added markup for navigation and copyright info in the footer. I also update the link to the CSS to conform with our general site branding requirements. You can generate a basic template using Pandoc.</p>
      <pre><code class="language-shell">pandoc --print-default-template=html5
      </code></pre>
      <p>I also use Pandoc to generate an &quot;about.md&quot; file describing the project and author info.  The content of the about.md is taken directly from the project's codemeta.json file after I've renamed the &quot;@&quot; JSON-LD fields (those cause problems for Pandoc). You can see the preparation of a temporary &quot;_codemeta.json&quot; using <code>cat</code> and <code>sed</code> to rename the fields. This is I use a Pandoc template to render the Markdown from.</p>
      <pre><code class="language-pandoc">  ---
        title: $name$
        ---
      
        About this software
        ===================
      
        $name$ $version$
        ----------------
      
        $if(author)$
        ### Authors
        
        $for(author)$
        - $it.givenName$ $it.familyName$
        $endfor$
        $endif$
        
        $if(description)$
        $description$
        $endif$
        
        
        $if(license)$- License: $license$$endif$
        0$if(codeRepository)$- GitHub: $codeRepository$$endif$
        $if(issueTracker)$- Issues: $issueTracker$$endif$
        
        
        $if(programmingLanguage)$
        ### Programming languages
        
        $for(programmingLanguage)$
        - $programmingLanguage$
        $endfor$
        $endif$
        
        $if(operatingSystem)$
        ### Operating Systems
        
        $for(operatingSystem)$
        - $operatingSystem$
        $endfor$
        $endif$
        
        $if(softwareRequirements)$
        ### Software Requiremets
        
        $for(softwareRequirements)$
        - $softwareRequirements$
        $endfor$
        $endif$
        
        $if(relatedLink)$
        ### Related Links
        
        $for(relatedLink)$
        - [$it$]($it$)
        $endfor$
        $endif$
      </code></pre>
      <p>This same technique can be repurposed to render a CITATION.cff if needed.</p>
      <h2>Pagefind</h2>
      <p>Pagefind provides three levels of functionality. First it will generate indexes for a full text search of your
      project's HTML pages. It also builds the necessary search UI for your static site. I include the search UI via a
      Markdown document that embeds the HTML markup described at <a href="https://pagefind.app/docs/">Pagefind.app</a>'s Getting started
      page.  When I invoke Pagefind I use the <code>--bundle-dir</code> option to be &quot;pagefind&quot; rather than &quot;_pagefind&quot;.  The reason is GitHub Pages ignores the &quot;<em>pagefind&quot; (probably ignores all directories with &quot;</em>&quot; prefix).</p>
      <p>If you need a quick static web server while you're writing and developing your documentation website Pagefind can
      provide that using the <code>--serve</code> option. Assuming you're in your project's directory then something like this should do the trick.</p>
      <pre><code class="language-shell">    pagefind --source . --bundle-dir=pagefind --serve
      </code></pre>
      
    </article>
  </section>
  <footer>
    <footer>
    <p>copyright Â© 2016 - 2025 R. S. Doiel<br /> <a
    href="/rssfeed.html">RSS</a> feeds and website built with <a
    href="https://rsdoiel.github.io/antennaApp">antennaApp</a>.
    </footer>
    <script type="module">
      await import('/pagefind/pagefind-highlight.js');
      new PagefindHighlight({ highlightParam: "highlight" });
    </script>
  </footer>
</body>
</html>
