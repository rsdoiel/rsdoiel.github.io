<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8" >
  <meta name="generator" content="antenna/0.0.15" >
  <meta name="date" content="2025-10-14T22:54:35-07:00" >
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
  <meta name="language" content="EN" >
  <title>R. S. Doiel, Software Engineer/Analyst &mdash; Robert's ramblings</title>
  <link rel="altenate" type="text/markdown" title="R. S. Doiel, Software Engineer/Analyst &mdash; Robert's ramblings" href="plpgsql-quick-intro.md" >
  <link rel="stylesheet" type="text/css" href="/css/site.css" >
  <link type="application/rss+xml" href="index.xml" rel="alternate" title="Recent Blog Post" >
  <link rel="alternate" title="Archive of Blog Posts" type="application/rss+xml" href="archive.xml" >
  <link rel="alternate" title="Markdown source for page" type="application/markdown" href="index.md" >
  <link rel="search" type="application/opensearchdescription+xml" title="Robert's Rambling Search Engine" href="osd.xml" >
  <script type="module" src="/modules/copyToClipboard.js" ></script>
</head>
<body>
  <nav>
    <ul>
    <li><a href="/" title="R. S. Doiel"><img class="blog-logo" src="/media/Wee-Free-Doiels-Summer-Reading.svg" alt="Wee Free Doiels, Summer Reading"></a></li>
    <li><a href="/">R. S. Doiel</a></li>
    <li><a href="/about.html">About</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/presentations.html">Presentations</a></li>
    <li><a href="/series/">Series</a></li>
    <li><a href="/search.html">Search</a></li>
    <li><a href="https://github.com/rsdoiel">GitHub</a></li>
    <li><a href="/rss.xml" title="RSS Feed">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9"></path>
    <path d="M4 4a16 16 0 0 1 16 16"></path>
    <circle cx="5" cy="19" r="1"></circle> </svg> RSS </a></li>
    </ul>
  </nav>

  <section>
    <article data-published="2022-08-24" data-link="https://rsdoiel.github.io/blog/2022/08/24/plpgsql-quick-intro.html">
      <h1>A Quick intro to PL/pgSQL</h1>
      <p>PL/pgSQL is a procedure language extended from SQL. It adds flow control and local state for procedures, functions and triggers. Procedures, functions and triggers are also the compilation unit. Visually PL/pgSQL looks similar to the MySQL or ORACLE counter parts. It reminds me of a mashup of ALGO and SQL. Like the unit of compilation, the unit of execution is also procedure, function or trigger.</p>
      <p>The Postgres documentation defines and explains the <a href="https://www.postgresql.org/docs/14/plpgsql.html">PL/pgSQL</a> and how it works.  This document is just a quick orientation with specific examples to provide context.</p>
      <h2>Hello World</h2>
      <p>Here is a &quot;helloworld&quot; procedure definition.</p>
      <pre><code class="language-sql">    CREATE PROCEDURE helloworld() AS $$
          DECLARE
          BEGIN
             RAISE NOTICE 'Hello WORLD!';
          END;
          $$ LANGUAGE plpgsql;
      </code></pre>
      <p>Let's take a look this line by line.</p>
      <ol>
      <li>CREATE PROCEDURE defines the procedure and the starting and ending delimiter for the procedure (e.g. <code>AS $$</code> the procedure's text ends when <code>$$</code> is encountered an second time.</li>
      <li>DECLARE is the block where you would declare the variables used in the procedure, we have none in this example</li>
      <li>The BEGIN starts the actual procedure instructions</li>
      <li>The <code>RAISE NOTICE</code> line is how you can display output to the console when the procedure is run</li>
      <li>The END completes the procedure definition</li>
      <li>the <code>$$ LANGUAGE plpgsql;</code> concludes the text defining the procedure and tells the database engine that procedure is written in PL/pgSQL.</li>
      </ol>
      <p>We can run the procedure using the &quot;CALL&quot; query.</p>
      <pre><code class="language-sql">    CALL helloworld()
      </code></pre>
      <p>NOTE: If you want to change the procedure you can &quot;DROP&quot; it first otherwise you'll get an error that it already exists.</p>
      <pre><code class="language-sql">    DROP PROCEDURE helloworld;
      </code></pre>
      <h2>Improving my workflow</h2>
      <p>SQL procedures are generally stored in the RDBMs in database environment. You can think of them as records in the system's database. Procedures and functions are created and can be dropped. While they can be manually typed in the database's shell it is easier to maintain them in plain text files outside the RDBM environment.</p>
      <ol>
      <li>Write the procedure in a text file.</li>
      <li>Load the text file (e.g. FILENAME) into Postgres
      a. outside the Postgres shell use <code>psql -f FILENAME</code>
      b. inside the Postgres shell used <code>\i FILENAME</code></li>
      <li>Call the procedure to test it</li>
      </ol>
      <p>To turn these steps into a look I use a &quot;CREATE OR REPLACE&quot; statement and be able to reload the updated procedure easier see <a href="https://www.postgresql.org/docs/14/plpgsql-development-tips.html">43.12. Tips for Developing in PL/pgSQL</a>.  Note in the revised example the &quot;-- &quot; lines are comments.</p>
      <p>Our revised <a href="helloworld.plpgsql">helloworld</a>.</p>
      <pre><code class="language-sql">    --
          -- Create (or replace) the new &quot;helloworld&quot; procedure.
          -- NOTE: this can be run with &quot;CALL&quot;
          --
          CREATE OR REPLACE PROCEDURE helloworld() AS $$
          DECLARE
          BEGIN
              RAISE NOTICE 'Hello World!';
          END;
          $$ LANGUAGE plpgsql;
      </code></pre>
      <h2>Hi There</h2>
      <p><a href="hithere.plpgsql">hithere</a> is similar to our helloworld example except it is a function that takes a parameter of the person's name. The function returns a &quot;VARCHAR&quot;, so this should work as part of a select statement.</p>
      <pre><code class="language-sql">    --
          -- This is a &quot;Hi There&quot; function. The function takes
          -- a single parameter and forms a greeting.
          --
          CREATE OR REPLACE FUNCTION hithere(name varchar) RETURNS varchar AS $$
          DECLARE
            greeting varchar;
          BEGIN
              IF name = '' THEN
                  greeting := 'Hi there!';
              ELSE
                  greeting := 'Hello ' || name || '!';
              END IF;
              RETURN greeting;
          END;
          $$ LANGUAGE plpgsql;
      </code></pre>
      <p>Giving it a try.</p>
      <pre><code class="language-shell">    SELECT hithere('Mojo Sam');
      </code></pre>
      <h2>Further reading</h2>
      <ul>
      <li><a href="https://www.postgresql.org/docs/14/plpgsql-control-structures.html#PLPGSQL-CONDITIONALS">Conditionals</a></li>
      <li><a href="https://www.postgresql.org/docs/14/plpgsql-control-structures.html#PLPGSQL-CONTROL-STRUCTURES-LOOPS">Loops</a></li>
      <li><a href="https://www.postgresql.org/docs/14/plpgsql-control-structures.html#PLPGSQL-STATEMENTS-CALLING-PROCEDURE">Calling a procedure</a></li>
      <li><a href="https://www.postgresql.org/docs/14/plpgsql-control-structures.html#PLPGSQL-STATEMENTS-RETURNING-PROCEDURE">Early return from a procedure</a></li>
      </ul>
      
    </article>
  </section>
  <footer>
    <footer>
    <p>copyright Â© 2016 - 2025 R. S. Doiel<br /> <a
    href="/rssfeed.html">RSS</a> feeds and website built with <a
    href="https://rsdoiel.github.io/antennaApp">antennaApp</a>.
    </footer>
    <script type="module">
      await import('/pagefind/pagefind-highlight.js');
      new PagefindHighlight({ highlightParam: "highlight" });
    </script>
  </footer>
</body>
</html>
